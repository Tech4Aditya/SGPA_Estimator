<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semester Grade Point Average (SGPA) Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Font Awesome for the X icon and theme icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Use Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* Enforced Dark Mode and Live Background */
        body {
            font-family: 'Inter', sans-serif;
            background: #0d111c;
            color: #d1d5db;
            transition: background-color 0.3s;
            
            /* Live Gradient Background Effect */
            background-image: linear-gradient(270deg, #0d111c, #1f2937, #0d111c, #1f2937);
            background-size: 400% 400%;
            animation: gradientMove 30s ease infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .subject-card {
            background-color: #1f2937; /* Darker card background */
            box-shadow: 0 4px 10px -2px rgba(255, 255, 255, 0.08), 0 2px 4px -2px rgba(255, 255, 255, 0.04);
            border: 1px solid #374151; /* Darker border */
            transition: transform 0.2s, background-color 0.3s, box-shadow 0.3s;
        }
        .subject-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.3), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
        }
        input {
            background-color: #374151 !important;
            border-color: #4b5563 !important;
            color: #d1d5db !important;
        }
        input[type="number"] {
            -moz-appearance: textfield;
            transition: background-color 0.3s, border-color 0.3s;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* Custom glow effect for the icon (Red -> Orange -> Green Cycle) */
        .cross-glow {
            animation: color-cycle 4s infinite alternate, pulse 1.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }
        
        @keyframes color-cycle {
            0%   { color: #ef4444; text-shadow: 0 0 8px #ef4444, 0 0 15px #f87171; } /* Red */
            50%  { color: #f97316; text-shadow: 0 0 8px #f97316, 0 0 15px #fb923c; } /* Orange */
            100% { color: #10b981; text-shadow: 0 0 8px #10b981, 0 0 15px #34d399; } /* Green */
        }

        /* Red Glow for Aditya Pandey's Logo */
        .red-glow {
            box-shadow: 0 0 15px 5px rgba(239, 68, 68, 0.5), 0 0 5px 2px rgba(239, 68, 68, 0.8) !important;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto">
        
        <!-- Top Controls: Semester Select (Theme Toggle removed) -->
        <div class="flex justify-start items-center mb-6">
            <div class="relative">
                <select id="sem-select" class="bg-gray-700 text-gray-200 border border-gray-600 rounded-lg p-2 text-sm shadow-md transition duration-300" onchange="alert('Semester selection feature is for future development. Only Semester 1 is available.'); this.value = 1;">
                    <option value="1" selected>Semester 1</option>
                    <option value="2" disabled>Semester 2 (Locked)</option>
                    <option value="3" disabled>Semester 3 (Locked)</option>
                    <option value="4" disabled>Semester 4 (Locked)</option>
                    <option value="5" disabled>Semester 5 (Locked)</option>
                    <option value="6" disabled>Semester 6 (Locked)</option>
                    <option value="7" disabled>Semester 7 (Locked)</option>
                    <option value="8" disabled>Semester 8 (Locked)</option>
                </select>
            </div>
        </div>

        <header class="text-center mb-10 p-6 bg-gray-800 rounded-xl shadow-2xl transition duration-300">
            
            <!-- Collaboration Banner -->
            <div class="flex items-center justify-center space-x-4 mb-6">
                <!-- Aditya Pandey Image with Red Glow -->
                <img 
                    src="https://github.com/Tech4Aditya/Virtual-Physics-Lab/blob/main/adityapandey.jpg?raw=true" 
                    alt="Aditya Pandey" 
                    class="red-glow h-16 w-16 md:h-20 md:w-20 rounded-full object-cover border-4 border-red-500 shadow-lg"
                    onerror="this.onerror=null; this.src='https://placehold.co/80x80/2563eb/ffffff?text=AP'"
                >
                
                <!-- Cross Icon with Color Cycle Glow -->
                <i class="fa-solid fa-xmark text-4xl cross-glow"></i>

                <!-- JIIT Logo -->
                <img 
                    src="https://github.com/Tech4Aditya/Virtual-Physics-Lab/blob/main/Logo-jiit%20(1).png?raw=true" 
                    alt="JIIT Noida Logo" 
                    class="h-16 w-16 md:h-20 md:w-20 object-contain rounded-full bg-white p-1 border-4 border-blue-500 shadow-lg"
                    onerror="this.onerror=null; this.src='https://placehold.co/80x80/1e3a8a/ffffff?text=JIIT'"
                >
            </div>
            
            <h1 class="text-3xl md:text-4xl font-extrabold text-blue-400">SGPA Score Estimator</h1>
            <p class="text-gray-400 mt-2 text-lg">Calculate your Semester Grade Point Average. (Credits vary per subject)</p>
        </header>

        <!-- Grade Scale Customization Panel -->
        <div class="mb-8">
            <button onclick="toggleGradeScalePanel()" class="w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 flex justify-between items-center">
                <span>Customize Grading Scale (Default: A+ @ 80+)</span>
                <span id="toggle-icon-panel">▼</span>
            </button>

            <div id="grade-scale-panel" class="mt-4 p-6 bg-gray-800 rounded-xl border border-indigo-700 hidden transition duration-300">
                <p class="font-semibold text-gray-300 mb-4">Set Minimum Marks Required for Each Grade Point (Max 100):</p>
                <div id="scale-inputs" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <!-- Inputs injected here -->
                </div>
                <div class="mt-6 flex justify-end">
                    <button onclick="resetGradeScale()" class="bg-red-500 text-white font-medium py-2 px-4 rounded-md hover:bg-red-600 transition duration-150 text-sm">
                        Reset to Default Scale
                    </button>
                </div>
            </div>
        </div>

        <!-- Subject Cards Container -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10" id="subjects-container">
            <!-- Subject Cards will be injected here -->
        </div>

        <!-- SGPA Result Panel -->
        <div class="bg-gradient-to-r from-green-500 to-teal-600 p-6 rounded-xl shadow-2xl text-white text-center">
            <p class="text-xl font-semibold mb-2">Estimated SGPA</p>
            <div id="sgpa-result" class="text-6xl font-black">0.00</div>
            <p id="sgpa-summary" class="mt-3 text-lg font-medium">Enter your marks above to see your result.</p>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const DEFAULT_GRADE_SCALE = {
            10: 80, // A+
            9: 70,  // A
            8: 65,  // B+
            7: 60,  // B
            6: 55,  // C+
            5: 50,  // C
            4: 40,  // D (New Passing Grade)
            // 0: < 40 (F)
        };
        let currentGradeScale = { ...DEFAULT_GRADE_SCALE };

        // Global Constants - Refined structure to include distinct accent colors
        const SUBJECTS = [
            // Title Color (text-*) and Border Color (border-*) are used for clean accents
            { name: "SDF-1", credits: 4, components: [{ type: 'Midsem', max: 30 }, { type: 'Endsem', max: 40 }, { type: 'TA', max: 30 }], titleColor: 'text-amber-400', borderColor: 'border-amber-400' }, 
            { name: "Physics-1", credits: 4, components: [{ type: 'Midsem', max: 30 }, { type: 'Endsem', max: 40 }, { type: 'TA', max: 30 }], titleColor: 'text-cyan-400', borderColor: 'border-cyan-400' }, 
            { name: "Maths-1", credits: 4, components: [{ type: 'Midsem', max: 30 }, { type: 'Endsem', max: 40 }, { type: 'TA', max: 30 }], titleColor: 'text-fuchsia-400', borderColor: 'border-fuchsia-400' }, 
            { name: "BEL-1", credits: 4, components: [{ type: 'Midsem', max: 30 }, { type: 'Endsem', max: 40 }, { type: 'TA', max: 30 }], titleColor: 'text-emerald-400', borderColor: 'border-emerald-400' }, 
            { name: "English", credits: 1.5, components: [{ type: 'Midsem', max: 30 }, { type: 'Endsem', max: 40 }, { type: 'TA', max: 30 }], titleColor: 'text-slate-400', borderColor: 'border-slate-500' }, 
            { name: "EDD Lab", credits: 1.5, components: [{ type: 'Midsem', max: 20 }, { type: 'Endsem', max: 20 }, { type: 'TA', max: 60 }], titleColor: 'text-purple-400', borderColor: 'border-purple-400' }, 
            { name: "SDF LAB", credits: 1, components: [{ type: 'Midsem', max: 20 }, { type: 'Endsem', max: 20 }, { type: 'TA', max: 60 }], titleColor: 'text-amber-500', borderColor: 'border-amber-500' }, 
            { name: "BEL LAB", credits: 1, components: [{ type: 'Midsem', max: 20 }, { type: 'Endsem', max: 20 }, { type: 'TA', max: 60 }], titleColor: 'text-emerald-500', borderColor: 'border-emerald-500' }, 
            { name: "Physics Lab", credits: 1, components: [{ type: 'Midsem', max: 20 }, { type: 'Endsem', max: 20 }, { type: 'TA', max: 60 }], titleColor: 'text-cyan-500', borderColor: 'border-cyan-500' }
        ];

        // --- Grade Scale Logic ---

        function loadGradeScale() {
            try {
                const storedScale = localStorage.getItem('sgpaGradeScale');
                if (storedScale) {
                    currentGradeScale = JSON.parse(storedScale);
                } else {
                    currentGradeScale = { ...DEFAULT_GRADE_SCALE };
                }
            } catch (e) {
                console.error("Could not load grade scale from storage.", e);
                currentGradeScale = { ...DEFAULT_GRADE_SCALE };
            }
            renderGradeScaleInputs();
        }

        function saveGradeScale() {
            try {
                localStorage.setItem('sgpaGradeScale', JSON.stringify(currentGradeScale));
            } catch (e) {
                console.error("Could not save grade scale to storage.", e);
            }
            calculateSGPA(); // Recalculate everything with the new scale
        }

        function renderGradeScaleInputs() {
            const scaleInputsEl = document.getElementById('scale-inputs');
            if (!scaleInputsEl) return;
            
            let html = '';
            // Only include points 5 through 10 in the customizable UI for simplicity, plus the new D grade (4)
            const points = Object.keys(DEFAULT_GRADE_SCALE).map(Number).sort((a, b) => b - a);

            points.forEach(point => {
                const gradeName = getGradeNameByPoint(point);
                // Only show custom inputs for grades C (5) and above, plus the new D grade (4)
                if (point >= 4) {
                    html += `
                        <div>
                            <label for="grade-${point}" class="block text-xs font-medium text-gray-400 mb-1">Min. Marks for ${gradeName} (${point} Pts)</label>
                            <input 
                                type="number" 
                                id="grade-${point}" 
                                class="w-full p-2 border border-gray-600 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm font-semibold text-center"
                                min="0" 
                                max="100" 
                                value="${currentGradeScale[point] || 0}"
                                oninput="updateGradeScale(${point}, this.value)"
                            />
                        </div>
                    `;
                }
            });
            scaleInputsEl.innerHTML = html;
        }

        function updateGradeScale(point, value) {
            let numValue = parseInt(value);
            if (isNaN(numValue) || numValue < 0) {
                numValue = 0;
            }
            if (numValue > 100) {
                numValue = 100;
            }
            
            const points = Object.keys(currentGradeScale).map(Number).sort((a, b) => b - a);
            const index = points.indexOf(point);

            // Check against the next higher point
            if (index > 0) {
                const nextHigherPoint = points[index - 1];
                if (numValue > (currentGradeScale[nextHigherPoint] || 100)) {
                    numValue = (currentGradeScale[nextHigherPoint] || 100);
                    document.getElementById(`grade-${point}`).value = numValue;
                }
            }
            
            currentGradeScale[point] = numValue;
            saveGradeScale();
        }

        function resetGradeScale() {
            currentGradeScale = { ...DEFAULT_GRADE_SCALE };
            saveGradeScale();
            renderGradeScaleInputs(); // Update the input fields
        }

        function toggleGradeScalePanel() {
            const panel = document.getElementById('grade-scale-panel');
            const icon = document.getElementById('toggle-icon-panel');
            const isHidden = panel.classList.contains('hidden');
            
            if (isHidden) {
                panel.classList.remove('hidden');
                icon.textContent = '▲';
            } else {
                panel.classList.add('hidden');
                icon.textContent = '▼';
            }
        }
        
        function getGradeNameByPoint(point) {
            switch(point) {
                case 10: return "A+";
                case 9: return "A";
                case 8: return "B+";
                case 7: return "B";
                case 6: return "C+";
                case 5: return "C";
                case 4: return "D"; // New Grade Name
                default: return "N/A";
            }
        }

        /**
         * Determines the grade and grade point based on the total marks (out of 100).
         */
        function calculateGradePoint(marks) {
            // Include point 4 (D grade)
            const points = Object.keys(currentGradeScale).map(Number).sort((a, b) => b - a);

            for (const point of points) {
                if (marks >= (currentGradeScale[point] || 0)) {
                    return { grade: getGradeNameByPoint(point), points: point };
                }
            }
            // If marks are below the minimum for D grade (4 points), it is F (0 points)
            return { grade: "F", points: 0 };
        }

        // --- Subject Rendering and Calculation Logic ---

        /**
         * Renders the input fields for a single subject card.
         */
        function renderSubjectCard(subject) {
            const id = subject.name.toLowerCase().replace(/[^a-z0-9]/g, '');
            const creditDisplay = subject.credits % 1 === 0 ? subject.credits : subject.credits.toFixed(1);
            
            const inputsHtml = subject.components.map(component => 
                renderInputField(id, component.type.toLowerCase(), `${component.type} (Max ${component.max})`, component.max)
            ).join('');

            // Clean UI: Dark background with color accent on the left border and title
            return `
                <div class="subject-card p-6 rounded-xl border-l-4 ${subject.borderColor}">
                    <h2 class="text-xl font-bold ${subject.titleColor} mb-4">${subject.name} (${creditDisplay} Credits)</h2>
                    
                    <div class="grid grid-cols-3 gap-3">
                        ${inputsHtml}
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-gray-700 flex justify-between items-center">
                        <div>
                            <p class="text-sm text-gray-400">Total Marks: <span id="${id}-total" class="font-bold text-white">0</span> / 100</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-400">Grade: <span id="${id}-grade" class="font-bold text-red-500">N/A</span></p>
                            <p class="text-sm text-gray-400">Points: <span id="${id}-points" class="font-bold text-white">0</span></p>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * Renders a single input field with constraints.
         */
        function renderInputField(subjectId, componentType, label, max) {
            return `
                <div>
                    <label for="${subjectId}-${componentType}" class="block text-xs font-medium text-gray-400 mb-1">${label}</label>
                    <input 
                        type="number" 
                        id="${subjectId}-${componentType}" 
                        data-max="${max}" 
                        class="w-full p-2 border border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold text-center"
                        min="0" 
                        max="${max}" 
                        value=""
                        placeholder="0-${max}"
                        oninput="validateInput(this); calculateSGPA();"
                    />
                </div>
            `;
        }
        
        /**
         * Ensures input value does not exceed the data-max attribute.
         * @param {HTMLInputElement} input
         */
        function validateInput(input) {
            let value = parseFloat(input.value);
            const max = parseFloat(input.getAttribute('data-max'));

            if (isNaN(value) || value < 0) {
                value = 0; 
            }
            if (value > max) {
                value = max;
                input.value = max;
            }
            
            if (value > 0) {
                input.value = value;
            }
        }


        /**
         * Main calculation function: Calculates SGPA and updates the UI.
         */
        function calculateSGPA() {
            let totalWeightedPoints = 0;
            let totalCredits = 0;

            SUBJECTS.forEach((subject) => {
                const id = subject.name.toLowerCase().replace(/[^a-z0-9]/g, '');
                const credits = subject.credits;
                let totalMarks = 0;
                let isEntered = false;

                // Sum up marks from all components dynamically
                subject.components.forEach(component => {
                    const componentType = component.type.toLowerCase();
                    const inputEl = document.getElementById(`${id}-${componentType}`);
                    const mark = parseFloat(inputEl.value) || 0;
                    totalMarks += mark;
                    
                    // Check if the user has physically entered a value (even if it's 0)
                    if (inputEl.value !== '') {
                        isEntered = true;
                    }
                });
                
                const totalEl = document.getElementById(`${id}-total`);
                const gradeEl = document.getElementById(`${id}-grade`);
                const pointsEl = document.getElementById(`${id}-points`);

                if (isEntered) {
                    
                    const { grade, points } = calculateGradePoint(totalMarks);

                    // Update individual subject results
                    totalEl.textContent = totalMarks;
                    gradeEl.textContent = grade;
                    pointsEl.textContent = points;
                    
                    // Update text color based on grade result
                    const gradeTextColor = points >= 7 ? 'text-green-400' : 
                                           points >= 4 ? 'text-yellow-400' : 'text-red-400';
                    gradeEl.className = `font-bold ${gradeTextColor}`;

                    // Accumulate for SGPA
                    totalWeightedPoints += credits * points;
                    totalCredits += credits;

                } else {
                    // Reset if no marks entered for subject
                    totalEl.textContent = '0';
                    gradeEl.textContent = 'N/A';
                    pointsEl.textContent = '0';
                    gradeEl.className = 'font-bold text-gray-400';
                }
            });

            const sgpaEl = document.getElementById('sgpa-result');
            const summaryEl = document.getElementById('sgpa-summary');

            let sgpa = 0.00;

            if (totalCredits > 0) {
                sgpa = totalWeightedPoints / totalCredits;
                sgpaEl.textContent = sgpa.toFixed(2);
                
                // Update summary message
                let message;
                if (sgpa >= 9.0) {
                    message = "Outstanding! A stellar performance across the board.";
                } else if (sgpa >= 8.0) {
                    message = "Excellent work! Keep up the great effort.";
                } else if (sgpa >= 7.0) {
                    message = "Very good progress. Aiming higher for the next semester!";
                } else if (sgpa > 0.0) {
                    message = "A good start. Focus on improving your marks in the next term.";
                } else {
                    message = "Enter your marks to calculate your SGPA.";
                }
                summaryEl.textContent = message;

            } else {
                sgpaEl.textContent = '0.00';
                summaryEl.textContent = 'Enter your marks above to see your result.';
            }
        }

        /**
         * Initialize the application: render cards and attach event listeners.
         */
        function initializeApp() {
            // Theme is enforced via HTML class, no need for theme logic here.
            
            // 1. Load the customized grade scale (or default)
            loadGradeScale(); 
            
            // 2. Render subject cards
            const container = document.getElementById('subjects-container');
            container.innerHTML = SUBJECTS.map((sub) => renderSubjectCard(sub)).join('');

            // 3. Attach input listeners
            const inputs = container.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('keyup', calculateSGPA);
                input.addEventListener('change', calculateSGPA);
                input.addEventListener('blur', calculateSGPA); 
            });

            // 4. Initial calculation run
            calculateSGPA();
        }

        // Run the initialization function when the window loads
        window.onload = initializeApp;

    </script>

</body>
</html>
